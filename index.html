<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#7a5cff">
  <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cargas Agua</title>
  <link rel="stylesheet" href="stylesheet.css">
  <link rel="icon" type="image/png" href="minimal pastel water.png">
</head>
<body>
 




  <div class="login-container" id="login">
    <h2>Login Chofer</h2>
    <input id="user" placeholder="Usuario">
    <input id="pass" type="password" placeholder="ContraseÃ±a">
    <button id="btnIngresar" onclick="login()">Ingresar</button>
    <div class="loader" id="loader"></div>
    <div class="loading-text" id="loadingText"></div>



  </div>
  <div id="ventanaJuegos" style="width:100%; height:90vh; border:none;display: none;">
     <div style="display: flex;justify-content: right;">
     <button onclick="regresar()" style="width: min-content;margin-right: 10px;">regresar</button>
   </div> 
    <iframe id="gameFrame" style="width:100%; height:80vh; border:none;display: none;margin-right: 10px;"></iframe>
  
  </div>

  <div class="form-container" id="form" style="display:none;">
 <!-- Barra superior -->
  <div class="navbar">
    <h3>Menu</h3>
    <button class="hamburger" onclick="toggleMenu()">â˜°</button>
  </div>




  <h2 id="welcomeMsg"></h2>
<!-- MenÃº lateral -->
  <div id="sidebar" class="sidebar">
    <h2>ðŸŽ® Juegos</h2>
    <button onclick="openGame('memotest.html')">ðŸŽ´ Memotest</button>
    <button onclick="openGame('simon.html')">ðŸŽ¶ SimÃ³n Dice</button>
    <hr style="margin: 15px 0; border: none; border-top: 1px solid #ddd;">
    <h2>ðŸ“‹ Historial</h2>
    <button onclick="toggleHistorial()">ðŸ“Š Ver Historial</button>
  </div>

  
  
  
  
  
  
  
  
  
  
  
  <label for="dominio">Dominio:</label>
  <select id="dominio">
    <option>AB614WP</option>
    <option>AD877XB</option>
    <option>AB036KI</option>
    <option>AF342ED</option>
    <option>AD523LI</option>
    <option>AC284QS</option>
    <option>AF177JY</option>
    <option>AG971AZ</option>
    <option>AH032XO</option>
    <option>AF438XZ</option>
    <option>PAM204</option>
    <option>AH928ZS</option>
    <option>AG150WI</option>
  </select>

  <label for="cargadero">Cargadero:</label>
  <select id="cargadero">
    <option>CIPO</option>
    <option>CUTRA</option>
    <option>MBE</option>
    <option>PIN</option>
    <option>PEPE</option>
    <option>Z1</option>
  </select>

  <label for="m3">Metros cÃºbicos:</label>
  <select id="m3">
    <option>30</option>
    <option>20</option>
    <option>10</option>
  </select>

  <!-- SecciÃ³n del Historial -->
  <div id="historialContainer" style="display: none; margin-top: 20px; max-height: 300px; overflow-y: auto; background: #f9f9ff; padding: 15px; border-radius: 10px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
      <h3 style="margin: 0; color: #4a3f8f;">ðŸ“Š Ãšltimas Cargas (5 dÃ­as)</h3>
      <button onclick="toggleHistorial()" style="width: auto; padding: 5px 10px; font-size: 0.9em;">âœ•</button>
    </div>
    <div id="historialList" style="max-height: 250px; overflow-y: auto;"></div>
  </div>

 <button class="confirmar" id="btnEnviar" onclick="enviar()">
  <span class="icon">ðŸšš</span> Confirmar
</button>

<!-- Pop-up oculto -->
<div id="popupOverlay">
  <div id="popupBox">
    <h2 id="msjPopup">espera un momento........</h2>
    <p>Tu envÃ­o fue procesado correctamente.</p>
    <button id="closePopup">Cerrar</button>
  </div>
</div>










<div id="bienvenida" >
    
    <button onclick="logout()">Cerrar sesiÃ³n</button>
    <p>Cargas de hoy: <span id="counter">0</span></p>


</div>
<div class="loader" id="loaderEnvio"></div>
</div>
    <script  src="login.js"> </script>
    
    <SCript>

      const endPoint="https://script.google.com/macros/s/AKfycbxmrLYRZOvHp5fEmagYlMAeuP0nXIGq3KW86wXWydg_--pA7VLBMSPgnknPGxfoetWCmQ/exec";
      const loaderEnvio = document.getElementById("loaderEnvio");
      const btnEnviar = document.getElementById("btnEnviar");

      //const sendBtn = document.getElementById("sendBtn");
      const popupOverlay = document.getElementById("popupOverlay");
      const closePopup = document.getElementById("closePopup");



      async function enviar() {
      const data = {
        dominio: document.getElementById('dominio').value,
        cargadero: document.getElementById('cargadero').value,
        m3: document.getElementById('m3').value,
        chofer: localStorage.getItem('user') || 'demo',
        fecha: new Date().toLocaleString() // opcional: guardar fecha/hora
      };
      document.getElementById("btnEnviar").disabled = true;
      document.getElementById("msjPopup").innerText = "â³ Enviando registro...";
      document.getElementById("closePopup").style.display = "none";
      try {
        loaderEnvio.style.display = "block";
        //btnEnviar.disabled = true;
        btnEnviar.style.display = "none";
        
        popupOverlay.style.display = "block";// mostrar pop-up
        
        const res = await fetch(endPoint, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        
        loaderEnvio.style.display = "none";
       
        document.getElementById("msjPopup").innerText = "âœ… Registro enviado";
        document.getElementById("closePopup").style.display = "block";
        
        closePopup.addEventListener("click", () => {
        popupOverlay.style.display = "none"; // cerrar pop-up
        });
        
        btnEnviar.style.display = "block";
        //actualizar contador
        count++;
        localStorage.setItem("count", count);
        localStorage.setItem("today", getToday());
        document.getElementById("counter").textContent = count;
        
        // Guardar en historial
        guardarCarga(data);
        
        

        document.getElementById("btnEnviar").disabled = false;
      } catch (err) {
        console.error("Error enviando.......:", err);
        alert("No se pudo enviar. Queda activo hasta nuevo intento.");
        document.getElementById("btnEnviar").disabled = false;
        return; // no limpiar estado si falla envÃ­o
      }};














     if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js")
        .then(reg => console.log("Service Worker registrado:", reg))
        .catch(err => console.error("Error registrando SW:", err));
        });
      }

       function toggleMenu() {
      document.getElementById("sidebar").classList.toggle("active");
    }
    function openGame(url) {
      document.getElementById("gameFrame").src = url;
      document.getElementById("form").style.display = "none";
      document.getElementById("gameFrame").style.display = "block";
      document.getElementById("ventanaJuegos").style.display = "block";
      toggleMenu(); // cerrar menÃº al elegir juego
    }
    function regresar() {
      document.getElementById("form").style.display = "block";
      document.getElementById("ventanaJuegos").style.display = "none";
    }

    //logica del contador de envÃ­os
  function getToday() {
  const d = new Date();
  return d.toISOString().split('T')[0]; // formato YYYY-MM-DD
}

// Inicializar
let today = localStorage.getItem("today") || getToday();
let count = parseInt(localStorage.getItem("count")) || 0;

// Reset si cambiÃ³ el dÃ­a
if (today !== getToday()) {
  today = getToday();
  count = 0;
  localStorage.setItem("today", today);
  localStorage.setItem("count", count);
}

document.getElementById("counter").textContent = count;

// Funciones para el historial
function guardarCarga(data) {
  let historial = JSON.parse(localStorage.getItem('historialCargas')) || [];
  const carga = {
    id: Date.now(),
    dominio: data.dominio,
    cargadero: data.cargadero,
    m3: data.m3,
    chofer: data.chofer,
    fecha: new Date().toLocaleString('es-AR'),
    timestamp: Date.now()
  };
  historial.push(carga);
  localStorage.setItem('historialCargas', JSON.stringify(historial));
}

function obtenerHistorial5Dias() {
  const historial = JSON.parse(localStorage.getItem('historialCargas')) || [];
  const ahora = Date.now();
  const cincodias = 5 * 24 * 60 * 60 * 1000; // 5 dÃ­as en milisegundos
  
  return historial.filter(carga => (ahora - carga.timestamp) <= cincodias).reverse();
}

function mostrarHistorial() {
  const historial = obtenerHistorial5Dias();
  const historialList = document.getElementById('historialList');
  
  if (historial.length === 0) {
    historialList.innerHTML = '<p style="text-align: center; color: #999;">No hay cargas registradas</p>';
    return;
  }
  
  let html = '';
  historial.forEach((carga, index) => {
    html += `
      <div style="background: white; padding: 10px; margin: 8px 0; border-radius: 8px; border-left: 4px solid #7a5cff;">
        <div style="display: flex; justify-content: space-between; font-weight: 600; color: #4a3f8f;">
          <span>#${index + 1}</span>
          <span style="font-size: 0.9em; color: #999;">${carga.fecha}</span>
        </div>
        <p style="margin: 5px 0; font-size: 0.95em;">
          <strong>Dominio:</strong> ${carga.dominio} | 
          <strong>Cargadero:</strong> ${carga.cargadero} | 
          <strong>mÂ³:</strong> ${carga.m3}
        </p>
      </div>
    `;
  });
  historialList.innerHTML = html;
}

function toggleHistorial() {
  const container = document.getElementById('historialContainer');
  if (container.style.display === 'none') {
    mostrarHistorial();
    container.style.display = 'block';
  } else {
    container.style.display = 'none';
  }
}








    </SCript>
</body>
</html>
