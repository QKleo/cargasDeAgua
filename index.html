<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#7a5cff">
  <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cargas Agua</title>
  <link rel="stylesheet" href="stylesheet.css">
  <link rel="icon" type="image/png" href="minimal pastel water.png">
</head>
<body>
  <div class="login-container" id="login">
    <h2>Login Chofer</h2>
    <input id="user" placeholder="Usuario">
    <input id="pass" type="password" placeholder="ContraseÃ±a">
    <button id="btnIngresar" onclick="login()">Ingresar</button>
    <div class="loader" id="loader"></div>
    <div class="loading-text" id="loadingText"></div>



  </div>
  <div id="ventanaJuegos" style="width:100%; height:90vh; border:none;display: none;">
     <div style="display: flex;justify-content: right;">
     <button onclick="regresar()" style="width: min-content;margin-right: 10px;">regresar</button>
   </div> 
    <iframe id="gameFrame" style="width:100%; height:80vh; border:none;display: none;margin-right: 10px;"></iframe>
  
  </div>

  <div class="form-container" id="form" style="display:none;">
 <!-- Barra superior -->
  <div class="navbar">
    <h3>Menu</h3>
    <button class="hamburger" onclick="toggleMenu()">â˜°</button>
  </div>




  <h2 id="welcomeMsg"></h2>
<!-- MenÃº lateral -->
  <div id="sidebar" class="sidebar">
    <h2>ðŸŽ® Juegos</h2>
    <button onclick="openGame('memotest.html')">ðŸŽ´ Memotest</button>
    <button onclick="openGame('simon.html')">ðŸŽ¶ SimÃ³n Dice</button>
  </div>

  
  
  
  
  
  
  
  
  
  
  
  <label for="dominio">Dominio:</label>
  <select id="dominio">
    <option>AB614WP</option>
    <option>AD877XB</option>
    <option>AB036KI</option>
    <option>AF342ED</option>
    <option>AD523LI</option>
    <option>AC284QS</option>
    <option>AF177JY</option>
    <option>AG971AZ</option>
    <option>AH032XO</option>
    <option>AF438XZ</option>
    <option>PAM204</option>
    <option>AH928ZS</option>
    <option>AG150WI</option>
  </select>

  <label for="cargadero">Cargadero:</label>
  <select id="cargadero">
    <option>CIPO</option>
    <option>CUTRA</option>
    <option>MBE</option>
    <option>PIN</option>
    <option>PEPE</option>
    <option>Z1</option>
  </select>

  <label for="m3">Metros cÃºbicos:</label>
  <select id="m3">
    <option>30</option>
    <option>20</option>
    <option>10</option>
  </select>

 <button class="confirmar" id="btnEnviar" onclick="enviar()">
  <span class="icon">ðŸšš</span> Confirmar
</button>
<div id="bienvenida" >
    
    <button onclick="logout()">Cerrar sesiÃ³n</button>
</div>
<div class="loader" id="loaderEnvio"></div>
</div>
    <script  src="login.js"> </script>
    
    <SCript>

      const endPoint="https://script.google.com/macros/s/AKfycbxmrLYRZOvHp5fEmagYlMAeuP0nXIGq3KW86wXWydg_--pA7VLBMSPgnknPGxfoetWCmQ/exec";
      const loaderEnvio = document.getElementById("loaderEnvio");
      const btnEnviar = document.getElementById("btnEnviar");
      async function enviar() {
      const data = {
        dominio: document.getElementById('dominio').value,
        cargadero: document.getElementById('cargadero').value,
        m3: document.getElementById('m3').value,
        chofer: localStorage.getItem('user') || 'demo',
        fecha: new Date().toLocaleString() // opcional: guardar fecha/hora
      };
      document.getElementById("btnEnviar").disabled = true;

      try {
        loaderEnvio.style.display = "block";
        //btnEnviar.disabled = true;
        btnEnviar.style.display = "none";
        const res = await fetch(endPoint, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        //const data = await res.json();
       // console.log("Respuesta del servidor:", data);
        loaderEnvio.style.display = "none";
       // btnEnviar.disabled = false;
        btnEnviar.style.display = "block";
        //console.log("Carga enviada:", data); //ver en consola
        alert("carga enviada.");
        document.getElementById("btnEnviar").disabled = false;
      } catch (err) {
        console.error("Error enviando.......:", err);
        alert("No se pudo enviar. Queda activo hasta nuevo intento.");
        document.getElementById("btnEnviar").disabled = false;
        return; // no limpiar estado si falla envÃ­o
      }};














     if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
        navigator.serviceWorker.register("/sw.js")
        .then(reg => console.log("Service Worker registrado:", reg))
        .catch(err => console.error("Error registrando SW:", err));
        });
      }

       function toggleMenu() {
      document.getElementById("sidebar").classList.toggle("active");
    }
    function openGame(url) {
      document.getElementById("gameFrame").src = url;
      document.getElementById("form").style.display = "none";
      document.getElementById("gameFrame").style.display = "block";
      document.getElementById("ventanaJuegos").style.display = "block";
      toggleMenu(); // cerrar menÃº al elegir juego
    }
    function regresar() {
      document.getElementById("form").style.display = "block";
      document.getElementById("ventanaJuegos").style.display = "none";
    }





    </SCript>
</body>
</html>
