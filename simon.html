<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sim√≥n Dice Pastel Musical</title>
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(to bottom, #f5f0ff, #e6dfff);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 { color: #6a4fcf; }
    .board {
      display: grid;
      grid-template-columns: repeat(2, 120px);
      gap: 20px;
      margin-top: 20px;
    }
    .btn {
      width: 120px;
      height: 120px;
      border-radius: 20px;
      cursor: pointer;
      opacity: 1;
      transition: opacity 0.3s;
    }
    .btn.active { opacity: 0.4; }
    #mensaje { margin-top: 20px; font-weight: bold; color: #6a4fcf; text-align: center; }
    .ranking {
      margin-top: 20px;
      font-size: 16px;
      color: #333;
      background: #f0eaff;
      padding: 10px;
      border-radius: 8px;
      width: 250px;
    }
    button {
      margin-top: 15px;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      background: #6a4fcf;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover { background: #5439a6; }
  </style>
</head>
<body>
  <h1>Sim√≥n Dice</h1>
  <button onclick="startGame()">‚ñ∂Ô∏è Iniciar</button>
  <div class="board">
    <div class="btn" id="celeste" style="background:#aee7ff"></div>
    <div class="btn" id="rosa" style="background:#ffcce7"></div>
    <div class="btn" id="amarillo" style="background:#fff7a8"></div>
    <div class="btn" id="violeta" style="background:#d9caff"></div>
  </div>
  
  <div id="mensaje"></div>
  <div class="ranking">
    <h3>üèÜ Ranking local</h3>
    <ol id="ranking-list"></ol>
  </div>

  <script>
    const colors = ["celeste","rosa","amarillo","violeta"];
    let sequence = [];
    let playerSequence = [];
    let level = 0;

    // Web Audio API para notas cortas
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const notes = {
      celeste: 261.63, // Do
      rosa: 293.66,    // Re
      amarillo: 329.63,// Mi
      violeta: 349.23  // Fa
    };

    function playNote(freq) {
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = "sine";
      osc.frequency.value = freq;
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start();
      gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
      osc.stop(audioCtx.currentTime + 0.3);
    }

    function flash(id) {
      const el = document.getElementById(id);
      el.classList.add("active");
      playNote(notes[id]);
      setTimeout(() => el.classList.remove("active"), 300);
    }

    function playSequence() {
      let i = 0;
      const interval = setInterval(() => {
        flash(sequence[i]);
        i++;
        if (i >= sequence.length) clearInterval(interval);
      }, 700);
    }

    function nextLevel() {
      level++;
      playerSequence = [];
      sequence.push(colors[Math.floor(Math.random()*4)]);
      document.getElementById("mensaje").innerText = "Nivel " + level;
      playSequence();
    }

    function startGame() {
      sequence = [];
      level = 0;
      playerSequence = [];
      document.getElementById("mensaje").innerText = "¬°A jugar!";
      nextLevel();
    }

    function gameOver() {
      let medalla = "";
      if (level >= 10) {
        medalla = "ü•á Maestro Do‚ÄëRe‚ÄëMi";
      } else if (level >= 6) {
        medalla = "üé∂ Virtuoso Pastel";
      } else if (level >= 3) {
        medalla = "üíß Aprendiz Musical";
      } else {
        medalla = "üåû Persistente del Ritmo";
      }
      document.getElementById("mensaje").innerHTML = 
        `‚ùå Fallaste en nivel ${level}.<br>${medalla}`;
      guardarRanking(level, medalla);
      mostrarRanking();
    }

    colors.forEach(color => {
      document.getElementById(color).addEventListener("click", () => {
        playerSequence.push(color);
        flash(color);
        const index = playerSequence.length-1;
        if (playerSequence[index] !== sequence[index]) {
          gameOver();
          return;
        }
        if (playerSequence.length === sequence.length) {
          setTimeout(nextLevel, 1000);
        }
      });
    });

    // Ranking local
    function guardarRanking(nivel, medalla) {
      let ranking = JSON.parse(localStorage.getItem("rankingSimon")) || [];
      ranking.push({nivel, medalla, fecha: new Date().toLocaleString()});
      ranking.sort((a, b) => b.nivel - a.nivel);
      ranking = ranking.slice(0, 3); // top 3
      localStorage.setItem("rankingSimon", JSON.stringify(ranking));
    }

    function mostrarRanking() {
      let ranking = JSON.parse(localStorage.getItem("rankingSimon")) || [];
      const list = document.getElementById("ranking-list");
      list.innerHTML = "";
      ranking.forEach(r => {
        const li = document.createElement("li");
        li.textContent = `Nivel ${r.nivel} - ${r.medalla} (${r.fecha})`;
        list.appendChild(li);
      });
    }
    

    mostrarRanking();
  </script>
</body>
</html>